<!DOCTYPE html>
<html lang="es">

<head>
  <title>CENSIS - Instituto Geof&iacute;sico del Per&uacute; </title>
  <meta charset="utf-8"/>
  <link rel="stylesheet" tpye="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
  <link rel="stylesheet" tpye="text/css" href="https://cdn.datatables.net/1.10.25/css/dataTables.semanticui.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.25/js/dataTables.semanticui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>

  <style>
    .igp-btn {
      margin-bottom: 10px !important;
    }

    .fa-file-pdf {
      color: red;
      font-size: 18px;
    }

    .hide {
      display: none;
    }

    .reporte-sismoslogicos-acelerometricos {
      text-align: center !important;
    }

    .btn-ra {
      display:
        contents;
    }

    #mapid {
      height: 240px;
    }

    .leaflet-draw-toolbar .leaflet-draw-draw-rectangle {
      background: url("img/icons8-rectangle-20.png") no-repeat !important;
      background-position: center !important;
      background-color: #FFF !important;
    }

    .leaflet-control-layers {
      visibility: hidden !important;
      position: absolute !important;
    }
  </style>
</head>

<body>
  <div class="g">
    <div>
      <script type="text/javascript" src="//leaflet.github.io/Leaflet.draw/docs/examples/libs/leaflet-src.js"></script>
      <link rel="stylesheet" type="text/css" href="//leaflet.github.io/Leaflet.draw/docs/examples/libs/leaflet.css" />
      <script src="//leaflet.github.io/Leaflet.draw/src/Leaflet.draw.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/Leaflet.Draw.Event.js"></script>
      <link rel="stylesheet" href="//leaflet.github.io/Leaflet.draw/src/leaflet.draw.css" />
      <script src="//leaflet.github.io/Leaflet.draw/src/Toolbar.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/Tooltip.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/GeometryUtil.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/LatLngUtil.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/LineUtil.Intersect.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/Polygon.Intersect.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/Polyline.Intersect.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/ext/TouchEvents.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/DrawToolbar.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Feature.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.SimpleShape.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Polyline.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Marker.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Circle.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.CircleMarker.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Polygon.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/draw/handler/Draw.Rectangle.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/EditToolbar.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/EditToolbar.Edit.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/EditToolbar.Delete.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/Control.Draw.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.Poly.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.SimpleShape.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.Rectangle.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.Marker.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.CircleMarker.js"></script>
      <script src="//leaflet.github.io/Leaflet.draw/src/edit/handler/Edit.Circle.js"></script>

      <div class="ui container">
        <div class="ui two column stackable grid">
          <div class="twelve wide column">
            <div class="ui stackable four column grid">
              <div class="nine wide column ">
                <form class="ui form segment">
                  <h4>Coordenadas:</h4>
                  <div class="fields">
                    <div class="field">
                      <label for="latLngb">Latitud norte</label>
                      <input type="text" placeholder="" class="ui large" id="latLngb">
                    </div>
                    <div class="field">
                      <label for="latLngc">Longitudoeste</label>
                      <input type="text" placeholder="" id="latLngc">
                    </div>
                    <div class="field">
                      <label for="latLngc">Longitud este </label>
                      <input type="text" placeholder="" id="latLngd">
                    </div>
                    <div class="field">
                      <label for="latLnga">Latitud sur</label>
                      <input type="text" placeholder="" id="latLnga">
                    </div><br><br>
                  </div>
                </form>

              </div>
            </div>

            <div id="mapid"></div>
            <div id="mapLista"></div>

            <table id="misdatossismicos"
              class="ui table celled striped reporte-sismoslogicos-acelerometricos igp-us-sr dataTable no-footer"
              style="width:100%">
              <thead>
                <tr>
                  <th>Fecha y hora UTC <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verFechHor" alt=""></th>
                  <th>Latitudº y longitudº <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verLatLong" alt=""></th>
                  <th>Profundidad <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verProfundidad" alt=""></th>
                  <th>Magnitud mb <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verMagnitud" alt=""></th>
                  <th>Magnitud Ms <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verMagnitud" alt=""></th>
                  <th>Magnitud Mw <img src="https://ultimosismo.igp.gob.pe/img/btn_help.png"
                      class="img-help verMagnitud" alt=""></th>
                </tr>
              </thead>
              <tbody class="datos-sismicos">
                <!--<tr align="center"><td colspan="8"><i>Aún no has realizado una consulta</i></td></tr>-->
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        var table = $('#misdatossismicos').DataTable({
          "responsive": "true",
          "pagingType": "simple",
          "language": {
            "sProcessing": "Procesando...",
            "sLengthMenu": "Mostrar _MENU_",
            "sZeroRecords": "No se encontraron reportes sismicos para el mes seleccionado.",
            "sEmptyTable": "Ningún dato disponible en esta tabla",
            "sInfo": "Registros del _START_ al _END_ de un total de _TOTAL_ ",
            "sInfoEmpty": "Registros del 0 al 0 de un total de 0 ",
            "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
            "sInfoPostFix": "",
            "sSearch": "Buscar:",
            "sUrl": "",
            "sInfoThousands": ",",
            "sLoadingRecords": "Cargando...",
            "oPaginate": {
              "sFirst": "Primero",
              "sLast": "Último",
              "sNext": "Siguiente",
              "sPrevious": "Anterior"
            },
            "oAria": {
              "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
              "sSortDescending": ": Activar para ordenar la columna de manera descendente"
            }
          }
        });


        $('.ui.menu a.item').on('click', function () {
          $(this).addClass('active').siblings().removeClass('active');
        });
        $('.ui.checkbox').checkbox();
        $('.ui.dropdown').dropdown();
        var attribution = '&copy; <a href="//openstreetmap.org/copyright">OpenStreetMap</a> contributors';
        var WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
          { attribution: attribution });
        var RoadsAndLabels = L.tileLayer('https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', { attribution: attribution });
        var map = new L.Map('mapid', {
          minZoom: 3,
          maxZoom: 17,
          center: [-10.0, -75.2],
          zoom: 4,
          scrollWheelZoom: false,
          layers: [WorldImagery, RoadsAndLabels],
        });

        var greenIcon = L.icon({
          iconUrl: 'img/green.png',
          shadowUrl: 'img/green.png',
          iconSize: [3, 3],
          shadowSize: [3, 3],
          iconAnchor: [3, 3],
          shadowAnchor: [3, 3]
        });
        var redIcon = L.icon({
          iconUrl: 'img/red.png',
          shadowUrl: 'img/red.png',
          iconSize: [3, 3],
          shadowSize: [3, 3],
          iconAnchor: [3, 3],
          shadowAnchor: [3, 3]
        });
        var blueIcon = L.icon({
          iconUrl: 'img/blue.png',
          shadowUrl: 'img/blue.png',
          iconSize: [3, 3],
          shadowSize: [3, 3],
          iconAnchor: [3, 3],
          shadowAnchor: [3, 3]
        });

        var drawnItems = L.featureGroup();
        map.addLayer(drawnItems);

        var options = {
          draw: {
            rectangle: false,
            /*{
                allowIntersection: false,
                showArea: true,
                shapeOptions: {
                  color: '#662d91',
                  clickable: false
                }
            },*/
            circlemarker: false,
            marker: false,
            polyline: false,
            polygon: false,
            circle: false
          },
          edit: false/*{
              featureGroup: drawnItems,
              remove: false
          }*/
        };
        var drawControl = new L.Control.Draw(options);
        map.addControl(drawControl);

        L.control.layers({
          "Satélite": WorldImagery
        }, { 'mostrar área': drawnItems }, { position: 'topleft', collapsed: true }).addTo(map);

        var bounds = [[-3.581, -82.382], [-16.701, -68.624]];
        var rectangle = new L.Rectangle(bounds, {
          color: 'red',
          fillColor: '#f03',
          fillOpacity: 0.5
        });
        map.addLayer(rectangle);
        rectangle.editing.enable();
        showLatLngs(rectangle.getLatLngs());

        rectangle.on('edit', function (event) {
          var latlng = event.target.getLatLngs();
          showLatLngs(latlng);
        });

        /*Legend specific*/
        var legend = L.control({ position: "bottomleft" });

        legend.onAdd = function (map) {
          var div = L.DomUtil.create("div", "legend");
          div.innerHTML += "<h4 style='color:#ffffff'>Sismos por profundidad:</h4>";
          div.innerHTML += '<span style="color:#ffffff"><img width="8" src="img/green.png"> Menos de 61 km de profundidad</span><br>';
          div.innerHTML += '<span style="color:#ffffff"><img width="8" src="img/red.png"> Entre 61 y 350 km de profundidad</span><br>';
          div.innerHTML += '<span style="color:#ffffff"><img width="8" src="img/blue.png"> Mayor o igual a 351 km de profundidad</span><br>';

          return div;
        };
        legend.addTo(map);
        var markers = [];
        $("#btndatasismica").click(function () {
          var a = $("#latLnga").val();
          var b = $("#latLngb").val();
          var c = $("#latLngc").val();
          var d = $("#latLngd").val();
          a = a.substring(0, 4 + a.indexOf("."));
          b = b.substring(0, 4 + b.indexOf("."));
          c = c.substring(0, 4 + c.indexOf("."));
          d = d.substring(0, 4 + d.indexOf("."));
          rectangle.setLatLngs(
            [[a, c], [b, c], [b, d], [a, d]]
          );

          $("#latLnga").val(a);
          $("#latLngb").val(b);
          $("#latLngc").val(c);
          $("#latLngd").val(d);

          var e = $("input[name='datasismica']:checked").val();
          var result;
          var magnitud = $("#cbmagnitud").val();
          magnitud = (magnitud != "") ? parseInt(magnitud) : 0;
          var profundidad = $("#txtprofundidad").val();
          profundidad = (profundidad != "") ? parseInt(profundidad) : 0;

          table.destroy();
          table = $('#misdatossismicos').DataTable({
            "responsive": "true",
            "pagingType": "simple",
            "language": {
              "sProcessing": "Procesando...",
              "sLengthMenu": "Mostrar _MENU_",
              "sZeroRecords": "No se encontraron reportes sismicos para el mes seleccionado.",
              "sEmptyTable": "Ningún dato disponible en esta tabla",
              "sInfo": "Registros del _START_ al _END_ de un total de _TOTAL_ ",
              "sInfoEmpty": "Registros del 0 al 0 de un total de 0 ",
              "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
              "sInfoPostFix": "",
              "sSearch": "Buscar:",
              "sUrl": "",
              "sInfoThousands": ",",
              "sLoadingRecords": "Cargando...",
              "oPaginate": {
                "sFirst": "Primero",
                "sLast": "Último",
                "sNext": "Siguiente",
                "sPrevious": "Anterior"
              },
              "oAria": {
                "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                "sSortDescending": ": Activar para ordenar la columna de manera descendente"
              }
            },
            ajax: {
              //url: 'some-url-for-get-data/' + a + '/' + b + '/' + c + '/' + d + '/' + e + '/' + magnitud + '/' + profundidad,
              url:'data.json',
              type: 'POST',
              dataSrc: 'prg_sismos',
              dataType: 'JSON',
              beforeSend: function () {
                if (markers.length > 0) {
                  markers.forEach(function (obj, i) {
                    map.removeLayer(obj);
                  });
                  markers = [];
                }
              }

            }, columns: [
              {
                data: 'fecha', render: function (data, type, row, meta) {
                  return row.fecha + " " + row.hora;
                }
              },
              {
                data: 'latitud', render: function (data, type, row, meta) {
                  return row.latitud + ", " + row.longitud;
                }
              },
              {
                data: 'profundidad', render: function (data, type, row, meta) {
                  var datos = "mb:" + row.magnitud_mb + ", mw:" + row.magnitud_mw + ", ms:" + row.magnitud_ms + ", prof:" + row.profundidad + "km, lat:" + row.latitud + ", long:" + row.longitud;

                  if (row.profundidad < 60) {
                    var marker = L.marker([row.latitud, row.longitud], { icon: redIcon }, { draggable: true }).bindPopup(datos);
                  } else if (row.profundidad > 60 && row.profundidad <= 350) {
                    var marker = L.marker([row.latitud, row.longitud], { icon: greenIcon }, { draggable: true }).bindPopup(datos);
                  } else {
                    var marker = L.marker([row.latitud, row.longitud], { icon: blueIcon }, { draggable: true }).bindPopup(datos);
                  }
                  markers.push(marker);
                  map.addLayer(marker);
                  return row.profundidad;
                }
              },
              { data: 'magnitud_mb' },
              { data: 'magnitud_ms' },
              { data: 'magnitud_mw' }
            ]
          });

        });
      });


      function showLatLngs(latlng) {
        $("#latLnga").val(latlng[0][0].lat.toFixed(3));
        $("#latLngb").val(latlng[0][1].lat.toFixed(3));
        $("#latLngc").val(latlng[0][0].lng.toFixed(3));
        $("#latLngd").val(latlng[0][2].lng.toFixed(3));
      }
    </script>
    

</body>

</html>